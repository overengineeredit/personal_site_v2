{{ $id := delimit (slice "github-safe" (partial "functions/uid.html" .)) "-" }}
{{- $repo := .Get "repo" -}}
{{- $githubURL := print "https://api.github.com/repos/" $repo -}}
{{- $showThumbnail := .Get "showThumbnail" | default true -}}
{{- $githubThumbnailURL := print "https://opengraph.githubassets.com/0/" $repo -}}

<!-- Static fallback data -->
{{- $fallbackData := dict 
  "html_url" (print "https://github.com/" $repo)
  "full_name" $repo
  "description" "GitHub Repository"
  "language" "Unknown"
  "stargazers_count" "‚≠ê"
  "forks" "üç¥"
-}}

<div class="github-card-wrapper">
  {{- $githubData := resources.GetRemote $githubURL | transform.Unmarshal -}}
  {{- if $githubData -}}
    <!-- Dynamic content loaded successfully -->
    <a id="{{ $id }}" target="_blank" href="{{ $githubData.html_url }}" class="cursor-pointer">
      <div class="w-full md:w-auto p-0 m-0 border border-neutral-200 dark:border-neutral-700 border rounded-md shadow-2xl">
        {{- if $showThumbnail -}}
          <div class="w-full nozoom">
            <img src="{{ $githubThumbnailURL }}" alt="GitHub Repository Thumbnail" class="nozoom mt-0 mb-0 w-full h-full object-cover">
          </div>
        {{- end -}}
        
        <div class="w-full md:w-auto pt-3 p-5">
          <div class="flex items-center">
            <span class="text-2xl text-neutral-800 dark:text-neutral mr-[10px]">
              {{ partial "icon.html" "github" }}
            </span>
            <div class="m-0 font-bold text-xl text-neutral-800 decoration-primary-500 hover:underline hover:underline-offset-2 dark:text-neutral">
              {{ $githubData.full_name | markdownify }}
            </div>
          </div>

          <p class="m-0 mt-2 text-md text-neutral-800 dark:text-neutral">
            {{ $githubData.description | markdownify }}
          </p>

          <div class="m-0 mt-2 flex items-center">
            {{ $language := $githubData.language | default "fallback" }}
            {{ $className := printf "background-color-%s" (md5 $language) }}
            <span class="mr-1 inline-block h-3 w-3 rounded-full {{ $className }}"></span>
            <div class="m-0 mr-5 text-md text-neutral-800 dark:text-neutral">
              {{ if $githubData.language }}{{ $githubData.language }}{{ else }}null{{ end }}
            </div>

            <span class="text-md mr-1 text-neutral-800 dark:text-neutral">
              {{ partial "icon.html" "star" }}
            </span>
            <div class="m-0 mr-5 text-md text-neutral-800 dark:text-neutral">
              {{ $githubData.stargazers_count }}
            </div>

            <span class="text-md mr-1 text-neutral-800 dark:text-neutral">
              {{ partial "icon.html" "fork" }}
            </span>
            <div class="m-0 mr-5 text-md text-neutral-800 dark:text-neutral">
              {{ $githubData.forks }}
            </div>
          </div>
        </div>
      </div>
    </a>
  {{- else -}}
    <!-- Fallback to static content when API fails -->
    <a id="{{ $id }}" target="_blank" href="{{ $fallbackData.html_url }}" class="cursor-pointer">
      <div class="w-full md:w-auto p-0 m-0 border border-neutral-200 dark:border-neutral-700 border rounded-md shadow-2xl bg-orange-50 dark:bg-orange-900/20">
        {{- if $showThumbnail -}}
          <div class="w-full nozoom">
            <img src="{{ $githubThumbnailURL }}" alt="GitHub Repository Thumbnail" class="nozoom mt-0 mb-0 w-full h-full object-cover">
          </div>
        {{- end -}}
        
        <div class="w-full md:w-auto pt-3 p-5">
          <div class="flex items-center">
            <span class="text-2xl text-neutral-800 dark:text-neutral mr-[10px]">
              {{ partial "icon.html" "github" }}
            </span>
            <div class="m-0 font-bold text-xl text-neutral-800 decoration-primary-500 hover:underline hover:underline-offset-2 dark:text-neutral">
              {{ $fallbackData.full_name | markdownify }}
            </div>
            <span class="ml-2 px-2 py-1 text-xs bg-orange-200 dark:bg-orange-800 text-orange-800 dark:text-orange-200 rounded">
              Static View
            </span>
          </div>

          <p class="m-0 mt-2 text-md text-neutral-800 dark:text-neutral">
            Visit repository for latest information
          </p>

          <div class="m-0 mt-2 flex items-center">
            <span class="mr-1 inline-block h-3 w-3 rounded-full bg-gray-400"></span>
            <div class="m-0 mr-5 text-md text-neutral-800 dark:text-neutral">
              {{ $fallbackData.language }}
            </div>

            <span class="text-md mr-1 text-neutral-800 dark:text-neutral">
              {{ partial "icon.html" "star" }}
            </span>
            <div class="m-0 mr-5 text-md text-neutral-800 dark:text-neutral">
              {{ $fallbackData.stargazers_count }}
            </div>

            <span class="text-md mr-1 text-neutral-800 dark:text-neutral">
              {{ partial "icon.html" "fork" }}
            </span>
            <div class="m-0 mr-5 text-md text-neutral-800 dark:text-neutral">
              {{ $fallbackData.forks }}
            </div>
          </div>
        </div>
      </div>
    </a>
  {{- end -}}
</div>
